<!DOCTYPE html>
<html lang="zh-Hans">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>Event Loop Promise async/await æ€»ç»“ | Zink&#39;s Blog</title>

    
    
    
    <meta property="og:site_name" content="Zink&#39;s Blog" />
    <meta property="og:title" content="Event Loop Promise async/await æ€»ç»“ | Zink&#39;s Blog"/>
    <meta itemprop="name" content="Event Loop Promise async/await æ€»ç»“ | Zink&#39;s Blog" />
    <meta name="twitter:title" content="Event Loop Promise async/await æ€»ç»“ | Zink&#39;s Blog" />
    <meta name="application-name" content="Event Loop Promise async/await æ€»ç»“ | Zink&#39;s Blog" />


    <meta name="description" content="" />
    <meta name="twitter:description" content=""/>
    <meta itemprop="description" content=""/>
    <meta property="og:description" content="" />

    


    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    
    <link rel="stylesheet" href="/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css">
    
</head>
    <script>
    (function() {
        const colorSchemeKey = 'ThemeColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.userColorScheme = 'dark';
        } else {
            document.documentElement.dataset.userColorScheme = 'light';
        }
    })();
</script>

    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="/">
                    
                    <span class="emoji">
                        ğŸ¥
                    </span>
                    
                    
                    Zink&#39;s Blog
                    </a>
            </div>
            <div class="flex">
                
                <a href="/about/">About</a>
                
                <a href="/articles/">Articles</a>
                
                <a href="/tags">Tags</a>
                
                <a href="/index.xml">RSS</a>
                
                <button id="dark-mode-button">
                  <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                  <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                </button>
            </div>
            </div>
    </div>
</nav>
        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>Event Loop Promise async/await æ€»ç»“</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                              
                            
                            By Zink | <time>February 11, 2022</time>
                            | 3 minutes
                        </div>
                        <div class="tags">
                            
                            <a href="/tags/javascript/">JavaScript</a>
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <h2 id="åŒæ­¥ä»»åŠ¡">
    <a href="#%e5%90%8c%e6%ad%a5%e4%bb%bb%e5%8a%a1" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    åŒæ­¥ä»»åŠ¡
</h2>
<p>å› ä¸º JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥åŒæ­¥ä»»åŠ¡åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ’é˜Ÿæ‰§è¡Œï¼Œå¹¶ä¸”åªæœ‰å½“å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</p>
<p>å½“ JavaScript è¿è¡Œæ—¶ï¼Œæ¯ä¸ªå‡½æ•°çš„æ‰§è¡Œéƒ½ä¼šè¿›å…¥è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ä¸­ï¼Œå½“å‰å‡½æ•°æ‰§è¡Œå®Œæ¯•åå°†å…¶ç§»å‡ºæ ˆï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœå…¶ä¸­æœ‰éå¸¸è€—æ—¶çš„å‡½æ•°æ‰§è¡Œï¼Œé‚£ä¹ˆè°ƒç”¨æ ˆå°±é˜»å¡äº†ï¼Œåé¢çš„ä»»åŠ¡åªèƒ½ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€æ— æ³•æ‰§è¡Œï¼Œä¸”æ­¤æ—¶ UI å¯¹é¢ä»»ä½•ç”¨æˆ·æ“ä½œéƒ½ä¸ä¼šå“åº”ï¼Œçœ‹èµ·æ¥å°±åƒç¨‹åºå´©æºƒäº†ä¸€æ ·ã€‚</p>
<p>ä¸ºä»€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰äº†å¼‚æ­¥ä»»åŠ¡</p>
<h2 id="å¼‚æ­¥ä»»åŠ¡">
    <a href="#%e5%bc%82%e6%ad%a5%e4%bb%bb%e5%8a%a1" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    å¼‚æ­¥ä»»åŠ¡
</h2>
<p>å¸¸è§çš„å¼‚æ­¥ï¼š</p>
<ul>
<li><code>setTimeout()</code></li>
<li><code>setInterval()</code></li>
<li><code>Promise.resolve().then()</code></li>
<li><code>fetch.then()</code></li>
</ul>
<p>å¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œä¹‹å‰ä¸ä¼šè¿›å…¥è°ƒç”¨æ ˆï¼Œå®ƒè¿›å…¥äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ï¼ˆEvent Loop Queueï¼‰ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œä¸”å¼‚æ­¥æ—¶æœºåˆ°äº†ï¼Œå°±ä¼šå°†äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ¨å…¥è°ƒç”¨æ ˆä¸­æ‰§è¡Œã€‚</p>
<h2 id="event-loop">
    <a href="#event-loop" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Event Loop
</h2>
<p>Event Loop çš„å·¥ä½œéå¸¸ç®€å•ï¼Œå®ƒåªæ˜¯ç›‘æ§è°ƒç”¨æ ˆå’Œå›è°ƒé˜Ÿåˆ—ï¼ˆåŒ…å«æ¯ä¸ªäº‹ä»¶å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚ click çš„å›è°ƒå‡½æ•°ï¼‰ã€‚å¦‚æœè°ƒç”¨æ ˆä¸ºç©ºï¼ŒEvent Loop å°†é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡<strong>ç§»é™¤å¹¶æ¨é€</strong>åˆ°è°ƒç”¨æ ˆã€‚</p>
<p>ä» ES6 å¼€å§‹ï¼ŒEvent Loop å¤„ç†å¼‚æ­¥ä¹Ÿåˆ†ä¸¤ç§ï¼Œåœ¨<code>Macrotask</code>ä¸­å¤„ç†<code>setTimeout</code>è¿™ç±»çš„ï¼Œåœ¨<code>Microtask</code>ä¸­å¤„ç†<code>Promise</code>è¿™ç±»çš„ã€‚å®ƒä¼šä¼˜å…ˆå¤„ç†<code>Microtask</code>ä¸­çš„ä»»åŠ¡</p>
<h2 id="nodejs-ä¸­çš„-event-loop">
    <a href="#nodejs-%e4%b8%ad%e7%9a%84-event-loop" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Node.js ä¸­çš„ Event Loop
</h2>
<p>Node.js ä¸­çš„ Event Loop åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼Œä¾æ¬¡æ˜¯ï¼š</p>
<ul>
<li>timers å®šæ—¶å™¨
<ul>
<li>è¿™ä¸ªé˜¶æ®µæ‰§è¡Œå·²è¢«<code>setTimeout()</code>å’Œ<code>setInterval()</code>è°ƒåº¦çš„å›è°ƒå‡½æ•°</li>
</ul>
</li>
<li>pending callbacks å¾…å®šå›è°ƒ
<ul>
<li>æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„I/Oå›è°ƒ</li>
</ul>
</li>
<li>idle, prepare
<ul>
<li>Node.js ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨</li>
</ul>
</li>
<li>poll è½®è¯¢
<ul>
<li>æ£€ç´¢æ–°çš„ I/O äº‹ä»¶ï¼›æ‰§è¡Œä¸ I/O ç›¸å…³çš„å›è°ƒï¼ˆå‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹ï¼Œé™¤äº†å…³é—­çš„å›è°ƒå‡½æ•°ï¼Œé‚£äº›ç”±è®¡æ—¶å™¨å’Œ <code>setImmediate()</code> è°ƒåº¦çš„ä¹‹å¤–ï¼‰ï¼Œå…¶ä½™æƒ…å†µ node å°†åœ¨é€‚å½“çš„æ—¶å€™åœ¨æ­¤é˜»å¡ï¼ˆç­‰å¾…ï¼‰</li>
</ul>
</li>
<li>check æ£€æµ‹
<ul>
<li><code>setImmediate()</code>å›è°ƒå‡½æ•°åœ¨è¿™é‡Œæ‰§è¡Œ</li>
</ul>
</li>
<li>close callback å…³é—­çš„å›è°ƒå‡½æ•°
<ul>
<li>ä¸€äº›å…³é—­çš„å›è°ƒå‡½æ•°ï¼Œå¦‚ï¼š<code>sockt.on('close', ...)</code></li>
</ul>
</li>
</ul>
<p><strong><code>process.nextTick()</code>çš„å›è°ƒä¼šåœ¨æ¯ä¸ªé˜¶æ®µç»“æŸä¹‹å‰è°ƒç”¨ã€‚</strong></p>
<p>æ¯æ¬¡è¿è¡Œçš„äº‹ä»¶å¾ªç¯ä¹‹é—´ï¼ŒNode.js æ£€æŸ¥å®ƒæ˜¯å¦åœ¨ç­‰å¾…ä»»ä½•å¼‚æ­¥ I/O æˆ–è®¡æ—¶å™¨ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™å®Œå…¨å…³é—­ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨ Node ä¸­é¦–æ¬¡æ‰§è¡Œ JavaScript ä»£ç æ—¶ï¼Œä¼šæœ‰å¼€å¯ Event Loop å’Œæ‰§è¡Œ JavaScript ä¸¤ä¸ªé˜¶æ®µï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µæ˜¯ä¸²è¡Œå‘ç”Ÿï¼Œå¼€å¯é€Ÿåº¦å—åˆ¶äºæœºå™¨æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè¿™ä¸¤ä¸ªå¼‚æ­¥ï¼Œä»–ä»¬çš„é¡ºåºå¹¶ä¸æ€»æ˜¯ç›¸åŒã€‚</p>
<h2 id="promise">
    <a href="#promise" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    Promise
</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">resolve</span><span class="p">({</span>
    	<span class="nx">info</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span>
    <span class="p">})</span>
  <span class="p">},</span> <span class="mi">3000</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">onFulfilled</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">onRejected</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reson</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">onFulfilled</span><span class="p">,</span> <span class="nx">onRejected</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªåŸºæœ¬çš„<code>Promise</code>ä½¿ç”¨æ–¹æ³•ï¼Œå¯¹äº<code>Promise</code>çš„å­¦ä¹ ï¼Œä¸ªäººè®¤ä¸ºç›´æ¥çœ‹ A+ è§„èŒƒæ¯”è¾ƒå¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šåŸºäº A+ è§„èŒƒçš„è§’åº¦æ¥è¯¦ç»†ä»‹ç» <code>Promise</code>ã€‚</p>
<p><code>Promise</code>è¡¨ç¤ºæ„é€ å‡½æ•°ï¼Œ<code>promise</code>è¡¨ç¤ºå®ä¾‹åŒ–å¯¹è±¡ã€‚</p>
<ol>
<li>
<p><code>Promise</code>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¿…é¡»æ˜¯å‡½æ•°ï¼Œå¦åˆ™æŠ›å‡º<code>TypeError</code></p>
</li>
<li>
<p><code>promise</code>å…·æœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ã€<code>fulfilled</code>ã€<code>rejected</code>ï¼Œ</p>
<ol>
<li>å½“çŠ¶æ€è½¬æ¢è‡³<code>fulfilled</code>æˆ–<code>rejected</code>æ—¶ï¼ŒçŠ¶æ€ä¸å¯å†æ¬¡å˜æ›´ï¼Œä¸”<code>fulfilled</code>çŠ¶æ€å¿…é¡»æœ‰ä¸€ä¸ªå€¼ï¼ˆä¸å¯å˜ï¼‰ï¼Œ<code>rejected</code>çŠ¶æ€å¿…é¡»æœ‰ä¸€ä¸ªå€¼ä½œä¸ºæ‹’ç»çš„åŸå› ï¼ˆä¸å¯å˜ï¼‰</li>
</ol>
</li>
<li>
<p><code>promise</code>å¿…é¡»å…·æœ‰<code>then</code>æ–¹æ³•ï¼Œç”¨æ¥è®¿é—®å½“å‰å€¼ï¼Œæˆ–æœ€ç»ˆå€¼ï¼Œæˆ–è¢«æ‹’ç»çš„åŸå› </p>
<ol>
<li><code>then</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚ä¸Šé¢ä»£ç æ‰€ç¤º<code>onFulfilled</code>å’Œ<code>onRejected</code></li>
<li>è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œä¸”å¦‚æœå…¶ä¸æ˜¯å‡½æ•°ï¼Œåˆ™å¿…é¡»è¢«å¿½ç•¥</li>
</ol>
</li>
<li>
<p><code>onFulfilled</code>å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™ä¼šåœ¨<code>promise</code>å·²ç»æ˜¯<code>fulfilled</code>çŠ¶æ€æ—¶è°ƒç”¨ï¼Œä¸”å°†<code>promise</code>çš„å€¼ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°<strong>åªè¢«è°ƒç”¨ä¸€æ¬¡</strong></p>
</li>
<li>
<p><code>onRejected</code>å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™ä¼šåœ¨<code>promise</code>å·²ç»æ˜¯<code>rejected</code>çŠ¶æ€æ—¶è°ƒç”¨ï¼Œä¸”å°†<code>promise</code>æ‹’ç»çš„åŸå› ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°<strong>åªè¢«è°ƒç”¨ä¸€æ¬¡</strong></p>
</li>
<li>
<p>åœ¨<a href="https://es5.github.io/#x10.3">æ‰§è¡Œä¸Šä¸‹æ–‡</a>å †æ ˆä»…åŒ…å«å¹³å°ä»£ç ä¹‹å‰ï¼Œä¸å¾—è°ƒç”¨ <code>onFulfilled</code> æˆ– <code>onRejected</code></p>
<ol>
<li>è¿™å¥è¯çš„æ„æ€å…¶å®å°±æ˜¯å°†<code>onFulfilled</code>/<code>onRejected</code>æ·»åŠ åˆ°<code>Microtask</code>é˜Ÿåˆ—ä¸­å»ï¼Œå¼‚æ­¥è°ƒç”¨å®ƒ</li>
</ol>
</li>
<li>
<p><code>onFulfilled</code>/<code>onRejected</code>ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œå…¶å†…éƒ¨æ²¡æœ‰<code>this</code></p>
</li>
<li>
<p><code>then</code>å¯ä»¥åœ¨åŒä¸€ä¸ª<code>promise</code>ä¸Šå¤šæ¬¡è°ƒç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(...,</span> <span class="p">...)</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(...,</span> <span class="p">...)</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(...,</span> <span class="p">...)</span>

<span class="c1">// onFulfilled/onRejected å¿…é¡»æŒ‰ç…§ä¹¦å†™é¡ºåºæ‰§è¡Œ
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>then</code>å¿…é¡»æ–°å»ºä¸”è¿”å›ä¸€ä¸ª<code>promise</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">promise2</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">onFulfilled</span><span class="p">,</span> <span class="nx">onRejected</span><span class="p">)</span>

<span class="nx">promise2</span> <span class="k">instanceof</span> <span class="nb">Promise</span> <span class="c1">//true
</span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å¦‚æœ <code>onFulfilled</code> æˆ– <code>onRejected</code> æŠ›å‡ºå¼‚å¸¸ <code>e</code>, <code>promise2</code> å¿…é¡»è¢«æ‹’ç»ï¼Œå¹¶æŠŠ <code>e</code> ä½œä¸ºè¢«æ‹’ç»çš„åŸå› </li>
<li>å¦‚æœ <code>onFulfilled</code> ä¸æ˜¯å‡½æ•°ï¼Œä¸” <code>promise</code>å¤„äºå·²å¤„ç†çŠ¶æ€ï¼Œåˆ™ <code>promise2</code> ä¹Ÿå¿…é¡»å¤„äºå·²å¤„ç†çŠ¶æ€ï¼Œä¸”æ‹¥æœ‰å’Œ <code>promise</code> å·²å¤„ç†çŠ¶æ€ç›¸åŒçš„å€¼ã€‚</li>
<li>å¦‚æœ <code>onRejected</code> ä¸æ˜¯å‡½æ•°ï¼Œä¸” <code>promise</code> å¤„äºå·²æ‹’ç»çŠ¶æ€ï¼Œåˆ™ <code>promise2</code> å¿…é¡»å¤„äºå·²æ‹’ç»çŠ¶æ€ï¼Œä¸”æ‹¥æœ‰å’Œ <code>promise</code> ç›¸åŒçš„æ‹’ç»åŸå› </li>
<li>2.2.7.1 å¦‚æœ <code>onFulfilled</code> æˆ– <code>onRejected</code> è¿”å›å€¼ <code>x</code>ï¼Œæ‰§è¡Œ<code>Promise</code>è§£å†³æ­¥éª¤ <code>[[Resolve]](promise2, x)</code></li>
</ol>
</li>
<li>
<p>åœ¨è¿™é‡Œå¼•å…¥ä¸€ä¸‹è§„èŒƒä¸­çš„<code>Promise</code>è§£å†³æ­¥éª¤ï¼Œè¿™é‡Œæˆ‘ä¼šç›´æ¥ç”¨ç™½è¯è®²ï¼Œå…¶ä»£ç å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/ZinkWu/ts-play-ground/blob/main/src/promise.ts#L67">æˆ‘çš„ä»£ç </a></p>
<ol>
<li>
<p><code>Promise</code>è§£å†³æ­¥éª¤å…¶å®å°±æ˜¯<code>Promise</code>ä¸­çš„ä¸€ä¸ªé™æ€ç§æœ‰æ–¹æ³•ï¼Œæš‚ä¸”å‘½åä¸º<code>resolveWith</code></p>
</li>
<li>
<p>å½“<code>onFulfilled</code>/<code>onRejected</code>è¿”å›å€¼<code>x</code>çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œ<code>resolveWith(promise2, x)</code>ï¼Œè¿™ä¸ª<code>promise2</code>åœ¨<code>then</code>æ–¹æ³•æ‰§è¡Œæ—¶åˆ›å»º</p>
</li>
<li>
<p>æ‰§è¡Œ<code>resolveWith(promise2, x)</code>ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹è§„åˆ™</p>
<ul>
<li>
<p>å¦‚æœ<code>promise2</code>å’Œ<code>x</code>å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œå³<code>promise2 === x</code>ä¸º<code>true</code>ï¼Œåˆ™ä»¥ä¸€ä¸ª<code>TypeError</code>ç±»å‹çš„å€¼ä½œä¸ºæ‹’ç»<code>promise2</code>çš„åŸå› </p>
</li>
<li>
<p>å¦‚æœ<code>x</code>æ˜¯ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ï¼Œæ¥æ”¶å…¶çŠ¶æ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="nx">cosnt</span> <span class="nx">promise2</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span> <span class="c1">//return äº†ä¸€ä¸ª fulfilled çŠ¶æ€çš„ Promise å¯¹è±¡
</span><span class="c1"></span><span class="p">})</span>

<span class="nx">promise2</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="nx">result</span><span class="p">.</span><span class="nx">state</span> <span class="c1">//true !!!è¿™é‡Œçš„ state å±æ€§å®é™…æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤º
</span><span class="c1"></span><span class="nx">promise2</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span> <span class="c1">//true !!!è¿™é‡Œçš„ value å±æ€§å®é™…æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤º
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å½“<code>x</code>å¤„äº<code>pending</code>çŠ¶æ€æ—¶ï¼Œ<code>promise2</code>ä¹Ÿå¿…é¡»ä¿æŒæœªå¤„ç†çŠ¶æ€ï¼Œç›´åˆ°<code>x</code>è¢«å¤„ç†æˆ–æ‹’ç»</li>
<li>å½“<code>x</code>å¤„äº<code>fulfilled</code>çŠ¶æ€æ—¶ï¼Œ<code>promise2</code>ä¹Ÿå¿…é¡»å¤„äº<code>fulfilled</code>çŠ¶æ€ï¼Œä¸”å€¼ç›¸åŒ</li>
<li>å½“<code>x</code>å¤„äº<code>rejected</code>çŠ¶æ€æ—¶ï¼Œ<code>promise2</code>ä¹Ÿå¿…é¡»å¤„äº<code>rejected</code>çŠ¶æ€ï¼Œä¸”æ‹’ç»çš„åŸå› ç›¸åŒ</li>
</ul>
</li>
<li>
<p>å½“<code>x</code>æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°æ—¶</p>
<ul>
<li>
<p>ç”¨<code>x.then</code>ä»£æ›¿<code>then</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">then</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">then</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¦‚æœåœ¨è·å–<code>x.then</code>çš„è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸<code>e</code>ï¼Œåˆ™æ‹’ç»<code>promise2</code>å¹¶ç”¨<code>e</code>ä½œä¸ºæ‹’ç»çš„åŸå› </p>
<ul>
<li>è§£é‡Šä»¥ä¸‹ä¸ºä»€ä¹ˆè·å–ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ<code>Object.defineProperty()</code>å¯ä»¥è®¾ç½®ä¸€ä¸ªå±æ€§çš„<code>getter</code>/<code>setter</code>ï¼Œå¯ä»¥åœ¨<code>getter</code>ä¸­æŠ›å‡ºå¼‚å¸¸</li>
</ul>
</li>
<li>
<p>å¦‚æœ<code>x.then</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆè¿™æ—¶å°±å¯ä»¥å°†<code>x</code>è§†ä¸º<code>thenable</code>ï¼Œå› ä¸ºå®ƒå…·æœ‰<code>then</code>æ–¹æ³•ï¼‰ï¼Œåˆ™ç”¨<code>x</code>ä½œä¸º<code>this</code>è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶å°†<code>resolvePromise</code>ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>rejectePromise</code>ä½œä¸ºå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">then</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">then</span>
<span class="k">if</span><span class="p">(</span><span class="nx">then</span> <span class="k">instanceof</span> <span class="nb">Function</span><span class="p">){</span>
  <span class="nx">then</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">resolvePromise</span><span class="p">,</span> <span class="nx">rejectPromise</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// çœ‹æ‡‚äº†å—ï¼Œå°±è·Ÿæˆ‘ä»¬çš„ promise.then(onFulfilled, onRejected)ä¸€æ ·ï¼Œåªä¸è¿‡æ”¹ç”¨ call è°ƒç”¨å¹¶æ”¹å˜ this æŒ‡å‘
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¦‚æœ/å½“ä½¿ç”¨å€¼ <code>y</code> è°ƒç”¨ <code>resolvePromise</code> æ—¶ï¼Œè¿è¡Œ <code>resolveWith(promise, y)</code>ï¼ˆè¿™é‡Œå…¶å®å°±æœ‰ç‚¹é€’å½’çš„å‘³é“äº†ï¼Œè§„èŒƒä¹Ÿç¡®å®æåˆ°äº†è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’ï¼Œå¦‚æœ<code>thenable</code>çš„<code>then</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>thenable</code>2ï¼Œä¸”<code>thenable2</code>çš„<code>then</code>ä¹Ÿè¿”å›ä¸€ä¸ª<code>thenable3</code>Â·Â·Â·ï¼Œä¸€ç›´è¿™æ ·å¥—å¨ƒï¼Œå°±ä¼šæ— é™é€’å½’ï¼Œæœ€åçˆ†æ ˆäº†ï¼‰</p>
</li>
<li>
<p>å¦‚æœ/å½“ä½¿ç”¨ <code>r</code> ä½œä¸ºåŸå› è°ƒç”¨ <code>rejectPromise</code> æ—¶ï¼Œç”¨ <code>r</code> æ‹’ç» <code>promise</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="nx">then</span> <span class="k">instanceof</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">then</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
    <span class="k">this</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">y</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolveWith</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">},</span>
    <span class="p">(</span><span class="nx">r</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span> 
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¸Šé¢ä¸¤å¥è¯çš„æ„æ€å°±æ˜¯è¯´ï¼Œ<code>x</code>ä½œä¸º<code>thenable</code>ï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„<code>then</code>æ–¹æ³•ï¼Œä¸”åœ¨å…¶ä¸­è‡ªç”±å†³å®šè°ƒç”¨<code>resolve</code>è¿˜æ˜¯<code>reject</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">thenable</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">then</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">){</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">promise2</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">thenable</span><span class="p">)</span> <span class="c1">//thenableçš„thenæ–¹æ³•ä¼šåœ¨promiseçš„thenä¸­è¢«è°ƒç”¨
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¦‚æœåŒæ—¶è°ƒç”¨ <code>resolvePromise</code> å’Œ <code>rejectPromise</code>ï¼Œæˆ–è€…å¯¹åŒä¸€ä¸ªå‚æ•°è¿›è¡Œå¤šæ¬¡è°ƒç”¨ï¼Œåˆ™ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼˜å…ˆï¼Œå¹¶ä¸”å¿½ç•¥ä»»ä½•åæ¥çš„çš„è°ƒç”¨ï¼ˆè¿™é‡Œå°±æ˜¯<code>onFulfilled</code>å’Œ<code>onRejected</code>çš„ç‰¹å¾ï¼‰</p>
</li>
<li>
<p>å¦‚æœè°ƒç”¨ <code>then</code> æ—¶æŠ›å‡ºå¼‚å¸¸ <code>e</code></p>
<ul>
<li>å¦‚æœ <code>resolvePromise</code> æˆ– <code>rejectPromise</code> å·²ç»è¢«è°ƒç”¨ï¼Œå¿½ç•¥è¯¥å¼‚å¸¸</li>
<li>å¦åˆ™ï¼Œæ‹’ç» <code>promise2</code> å¹¶ä»¥ <code>e</code> ä½œä¸ºæ‹’ç»åŸå› </li>
</ul>
</li>
<li>
<p>å¦‚æœ <code>then</code> ä¸æ˜¯å‡½æ•°ï¼Œç”¨ <code>x</code> å»æ‰§è¡Œ <code>promise2</code></p>
</li>
</ul>
</li>
<li>
<p>å¦‚æœ <code>x</code> ä¸æ˜¯å¯¹è±¡æˆ–å‡½æ•°ï¼Œç”¨ <code>x</code> å»æ‰§è¡Œ <code>promise2</code></p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>ä¸Šè¿°çš„<code>Promise</code>è§£å†³æ­¥éª¤ï¼Œç”¨ç™½è¯æ¥è¯´å°±æ˜¯</p>
<ol>
<li>å¦‚æœ<code>onFulfilled</code>æˆ–<code>onRejected</code>è¿”å›çš„<code>x</code>æ˜¯ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆ<code>then</code>æ–¹æ³•å°±è¿”å›ä¸€ä¸ªå¤„äº<code>onFulfilled</code>çš„æ–°çš„<code>promise</code>ï¼Œä¸”å€¼æ˜¯<code>x</code></li>
<li>å¦‚æœ<code>onFulfilled</code>æˆ–<code>onRejected</code>è¿”å›çš„<code>x</code>æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–å¯¹è±¡ï¼ˆå…¶å®å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡å•¦ï¼‰ï¼Œåˆ™åˆ¤æ–­<code>x</code>æ˜¯å¦å…·æœ‰<code>then</code>æ–¹æ³•ï¼ˆæˆ–è€…è¯´åˆ¤æ–­<code>x</code>æ˜¯å¦æ˜¯ä¸€ä¸ª<code>thenable</code>)
<ol>
<li>å¦‚æœ<code>x.then</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å–æ‰§è¡Œå®ƒï¼Œä¸”å®ƒå†…éƒ¨çš„<code>this</code>è¿˜æ˜¯<code>x</code>ï¼Œä¸”<code>x.then</code>æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<code>resolve</code>å’Œ<code>reject</code>ï¼Œ<code>x.then</code>è°ƒç”¨<code>resolve</code>/<code>reject</code>ï¼Œé‚£ä¹ˆ<code>promise2</code>ä¹Ÿä¼šæ˜¯å¯¹åº”çš„çŠ¶æ€ï¼Œä¸”å€¼å°±æ˜¯<code>x.then</code>è°ƒç”¨<code>resolve</code>/<code>reject</code>æ‰€ä¼ çš„å€¼</li>
</ol>
</li>
</ol>
</li>
<li>
<p>è‡³æ­¤ï¼ŒA+ è§„èŒƒå°±ç»“æŸäº†ï¼ŒA+ è§„èŒƒå®šä¹‰äº†<code>Promise</code>çš„åŸºæœ¬è¡Œä¸ºå’Œ<code>Promise</code>é“¾çš„å®ç°</p>
</li>
</ol>
<p><a href="https://github.com/lingirlsea/promisesaplus">A+ è¯‘æ–‡å‚è€ƒ</a></p>
<p><strong>ä»¥ä¸‹å†…å®¹å¾…æ›´æ–°</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <code>promise.catch()</code></li>
<li><input disabled="" type="checkbox"> <code>promise.finally()</code></li>
<li><input disabled="" type="checkbox"> <code>Promise.race()</code></li>
<li><input disabled="" type="checkbox"> <code>Promise.all()</code></li>
<li><input disabled="" type="checkbox"> <code>Promise.allSettled()</code></li>
<li><input disabled="" type="checkbox"> <code>Promise.any()</code></li>
<li><input disabled="" type="checkbox"> <code>Promise.resolve/reject()</code></li>
<li><input disabled="" type="checkbox"> <code>async/await</code></li>
</ul>

    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="/articles/whats-inheritance/" title="Previous post (older)">
            <span>Previous</span>
            ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼Ÿ
            </a>
        
        
        
        <a rel="next" href="/articles/2022-checklist/" title="Next post (newer)">
            <span>Next</span>
            2022 CheckList
            </a> 
        
    </nav>
    
</div>
 
<div class="container">
    
    <script src="https://giscus.app/client.js" 
        data-repo="zinkwu/zinkwu.github.io"
        data-repo-id="R_kgDOGj_r8w"
        
        data-category="Announcements"
        data-category-id="DIC_kwDOGj_r884CAZIx"
        
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        crossorigin="anonymous"
        async
        >
</script>

<script>
    function setGiscusTeheme(theme) {
        let giscus = document.querySelector('.giscus iframe');
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            )
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://giscus.app') return;
        setGiscusTeheme(document.documentElement.dataset.userColorScheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setGiscusTeheme(e.detail)
    })
</script>

</div>

</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="/">Â© 2021-2022 Zink&#39;s Blog</a>
            
        </nav>

        
    </section>
    <script defer src="/ts/features.a534d05c446023fa2ae2a638f87cc2443ad8e49f6aaeb4d9f24ed61d53766712.js" 
    data-enable-footnotes="false"
    ></script>
</footer>

    </body>
</html>